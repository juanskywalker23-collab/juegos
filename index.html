<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>TE AMO MONSE - TURBO FIX</title>
  <style>
    body { background: #000; color: white; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; touch-action: manipulation; }
    h1 { color: #ff4da6; text-shadow: 0 0 10px #ff4da6; margin: 10px 0; font-size: 24px; }
    #menu { display: flex; flex-direction: column; gap: 15px; text-align: center; }
    .btn { background: none; border: 2px solid #ff4da6; color: white; padding: 12px 24px; font-family: inherit; cursor: pointer; border-radius: 8px; font-size: 18px; transition: 0.3s; }
    canvas { border: 2px solid #ff4da6; display: none; background: #000; max-width: 95vw; max-height: 55vh; touch-action: none; }
    #hud { margin-top: 5px; display: none; font-size: 16px; color: #ff4da6; text-align: center; font-weight: bold; }
    #controls { display: none; grid-template-columns: repeat(3, 75px); gap: 12px; margin-top: 15px; justify-content: center; }
    .tbtn { width: 75px; height: 75px; background: rgba(255, 77, 166, 0.3); border: 3px solid #ff4da6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; user-select: none; -webkit-tap-highlight-color: transparent; }
    #gameOverOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
    #gameOverOverlay h2 { color: #ff4da6; font-size: 45px; text-shadow: 0 0 20px #ff4da6; }
  </style>
</head>
<body>

  <div id="gameOverOverlay">
    <h2>GAME OVER</h2>
    <p style="color:pink; font-size:26px;">TE AMO MONSE ‚ù§Ô∏è</p>
    <button class="btn" onclick="location.reload()">REINTENTAR</button>
  </div>

  <h1>TE AMO MONSE ‚ù§Ô∏è</h1>

  <div id="menu">
    <button class="btn" onclick="initMaze()">1. Laberinto ü•ï‚ù§Ô∏è</button>
    <button class="btn" onclick="initFlappy()">2. Flappy Bunny ‚ú®</button>
  </div>

  <div id="hud">Pts: <span id="score">0</span> | ‚ù§Ô∏è: <span id="lives">3</span> <br><span id="powerMode" style="color:yellow; display:none;">‚ú® MODO AMOR ‚ú®</span></div>
  
  <canvas id="gameCanvas" width="600" height="600"></canvas>

  <div id="controls">
    <div></div><div class="tbtn" id="btnUp">‚Üë</div><div></div>
    <div class="tbtn" id="btnLeft">‚Üê</div><div class="tbtn" id="btnDown">‚Üì</div><div class="tbtn" id="btnRight">‚Üí</div>
  </div>

  <button class="btn" id="backBtn" style="display:none; margin-top:10px;" onclick="location.reload()">Men√∫ Principal</button>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score'), livesEl = document.getElementById('lives'), powerEl = document.getElementById('powerMode');
    const controls = document.getElementById('controls'), backBtn = document.getElementById('backBtn');
    
    let score = 0, lives = 3, gameLoop, currentMode = '', gameActive = true, invul = 0;
    const mazeLayout = ["1111111111111111111111111","1000000000110000000000001","1011111110110111111111101","1010000010000001000000101","1010111011111111011100101","1010001000000000010000101","1011101110111111011110101","1000100000100000010000100","1110111111101111110110111","1000000000001000000000001","1011111111111011111111101","1010000000000010000000101","1010111111111110111110101","1010000000000000000000101","1011111011111111111011101","1000001000000000001000001","1111101111110111110111111","1000000000010000000000001","1011111111011111111111101","1010000000010000000000101","1010111111111111111100101","1010000000000000000000101","1011111111110111111111101","1000000000000000000000001","1111111111111111111111111"].map(r => r.split('').map(Number));

    let player = { x: 1, y: 1, dx: 0, dy: 0, power: 0, last: 0 };
    let ghosts = [], carrots = [], hearts = [];
    
    // FISICAS TURBO PARA FLAPPY
    let bird = { y: 300, dy: 0, gravity: 0.38, jump: -7.5 }; 
    let pipes = [], frame = 0, flappyStarted = false;

    function setDir(x, y) { player.dx = x; player.dy = y; }

    // Eventos t√°ctiles corregidos
    document.getElementById('btnUp').ontouchstart = (e) => { e.preventDefault(); setDir(0, -1); };
    document.getElementById('btnDown').ontouchstart = (e) => { e.preventDefault(); setDir(0, 1); };
    document.getElementById('btnLeft').ontouchstart = (e) => { e.preventDefault(); setDir(-1, 0); };
    document.getElementById('btnRight').ontouchstart = (e) => { e.preventDefault(); setDir(1, 0); };

    function initMaze() {
      currentMode = 'MAZE'; setupUI();
      controls.style.display = 'grid';
      player = { x: 1, y: 1, dx: 0, dy: 0, last: 0, power: 0 };
      carrots = []; hearts = []; ghosts = [];
      let spaces = [];
      for(let y=0; y<25; y++) for(let x=0; x<25; x++) if(mazeLayout[y][x]===0 && (x!==1||y!==1)) spaces.push({x,y});
      for(let i=0; i<6; i++) hearts.push(spaces.splice(Math.floor(Math.random()*spaces.length), 1)[0]);
      carrots = spaces;
      for(let i=0; i<3; i++) ghosts.push({x:12, y:12, dx:0, dy:1, last:0});
      run();
    }

    function initFlappy() {
      currentMode = 'FLAPPY'; setupUI();
      controls.style.display = 'none';
      const jumpAction = (e) => { 
        if(currentMode === 'FLAPPY' && gameActive) {
            flappyStarted = true; bird.dy = bird.jump; 
            if(e && e.cancelable) e.preventDefault();
        }
      };
      canvas.ontouchstart = jumpAction;
      canvas.onmousedown = jumpAction;
      run();
    }

    function setupUI() {
      document.getElementById('menu').style.display = 'none';
      canvas.style.display = 'block';
      document.getElementById('hud').style.display = 'block';
      backBtn.style.display = 'block';
      score = 0; lives = 3; scoreEl.innerText = 0; livesEl.innerText = 3;
      gameActive = true; flappyStarted = false; pipes = []; frame = 0;
    }

    function run(t) {
      if(!gameActive) return;
      ctx.clearRect(0,0,600,600);
      if(currentMode==='MAZE') updateMaze(t);
      else updateFlappy(t);
      gameLoop = requestAnimationFrame(run);
    }

    function updateMaze(t) {
      if(player.power > 0) { player.power--; powerEl.style.display = 'inline'; } else powerEl.style.display = 'none';
      if(t - player.last > 140) {
        if(mazeLayout[player.y+player.dy]?.[player.x+player.dx]===0) { player.x+=player.dx; player.y+=player.dy; }
        player.last = t;
      }
      carrots = carrots.filter(c => c.x===player.x && c.y===player.y ? (score+=10, scoreEl.innerText=score, false) : true);
      hearts = hearts.filter(h => h.x===player.x && h.y===player.y ? (player.power=400, score+=50, scoreEl.innerText=score, false) : true);
      ghosts.forEach(g => {
        if(t - g.last > 200) {
          let ds = [{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].filter(d => mazeLayout[g.y+d.y]?.[g.x+d.x]===0);
          let n = ds[Math.floor(Math.random()*ds.length)];
          if(n){g.dx=n.x; g.dy=n.y; g.x+=g.dx; g.y+=g.dy;} g.last=t;
        }
        if(g.x===player.x && g.y===player.y) {
          if(player.power>0) { g.x=12; g.y=12; score+=100; scoreEl.innerText=score; }
          else { lives--; livesEl.innerText=lives; player.x=1; player.y=1; player.dx=0; player.dy=0; if(lives<=0) die(); }
        }
      });
      ctx.strokeStyle = '#ff4da6';
      for(let y=0;y<25;y++) for(let x=0;x<25;x++) if(mazeLayout[y][x]) ctx.strokeRect(x*24,y*24,24,24);
      ctx.font = '16px Arial';
      carrots.forEach(c => ctx.fillText('ü•ï', c.x*24+4, c.y*24+18));
      hearts.forEach(h => ctx.fillText('‚ù§Ô∏è', h.x*24+4, h.y*24+18));
      ghosts.forEach(g => ctx.fillText(player.power>0 ? 'üò®' : 'üò†', g.x*24+4, g.y*24+18));
      ctx.font = '22px Arial';
      ctx.fillText('üê∞', player.x*24+2, player.y*24+20);
    }

    function updateFlappy() {
      if(!flappyStarted) { 
        ctx.fillStyle="white"; ctx.font="30px Courier New"; 
        ctx.fillText("TOCA PARA SALTAR", 170, 300); 
      } else {
        bird.dy += bird.gravity; bird.y += bird.dy;
        if(invul > 0) invul--;
        
        // VELOCIDAD DE TUBOS AUMENTADA
        if(frame++ % 65 === 0) pipes.push({x:600, h: Math.random()*250+120, counted: false});
        pipes.forEach(p => {
          p.x -= 6.5; 
          ctx.fillStyle = '#ff4da6';
          ctx.fillRect(p.x, 0, 50, p.h-100); 
          ctx.fillRect(p.x, p.h+100, 50, 600);
          
          if(invul===0 && p.x<95 && p.x>10 && (bird.y<p.h-95 || bird.y>p.h+85)) { 
            lives--; livesEl.innerText=lives; invul=60; if(lives<=0) die(); 
          }
          if(!p.counted && p.x<40) { score++; scoreEl.innerText=score; p.counted=true; }
        });
        pipes = pipes.filter(p => p.x > -60);
        if(bird.y>600 || bird.y<0) { lives--; livesEl.innerText=lives; bird.y=300; bird.dy=0; invul=60; if(lives<=0) die(); }
      }
      if(invul%10 < 5) { ctx.font='45px Arial'; ctx.fillText('üê∞', 40, bird.y); }
    }

    function die() { gameActive = false; document.getElementById('gameOverOverlay').style.display = 'flex'; }
  </script>
</body>
</html>